(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{612:function(t,n,e){"use strict";e.r(n);var a=e(28),p=Object(a.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"编写一个webpack的插件-plugin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写一个webpack的插件-plugin"}},[t._v("#")]),t._v(" 编写一个webpack的插件（plugin）")]),t._v(" "),e("p",[t._v("webpack插件的是用于代码的压缩，混淆等优化")]),t._v(" "),e("p",[t._v("webpack的插件本质上都是一些类，形如：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("class xxxxWebpackPlugin {\n    constructor (options) {\n        ....初始化\n    };\n    apply (compiler) {\n        // .....\n    }\n}\n")])])]),e("p",[t._v("关于apply函数，是每个插件在运行的时候都会执行的，其参数compiler可以看做是webpack的一个实例，可以利用他去调用插件的钩子函数，做相关操作。")]),t._v(" "),e("p",[e("strong",[t._v("其中 compilation:存放的是这次打包相关的内容，compilation:存放的是这次打包相关的内容")])]),t._v(" "),e("p",[t._v("钩子函数可以参考："),e("a",{attrs:{href:"https://www.webpackjs.com/api/compiler-hooks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.webpackjs.com/api/compiler-hooks/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("钩子函数分为同步和异步两种，他们的调用方式也有所不同。")]),t._v(" "),e("ul",[e("li",[t._v("异步钩子的调用形式：")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" compiler.hooks.[钩子函数名].tapAsync（‘插件名’, (compilation, cb) => {\n     ....\n     ....\n     cb();\n }）\n")])])]),e("ul",[e("li",[t._v("同步钩子的调用形式：")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" compiler.hooks.compiler.tap('CopyrightWebpackPlugin', (compilation) => {\n    ....\n    console.log('compiler')\n })\n")])])]),e("p",[t._v("现在有个需求是在webpack打包快结束之时，在dist目录生成一个copyright.txt文件")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("class CopyrightWebpackPlugin {\n  constructor (options) {\n    console.log('插件被使用了', options)\n  }\n  apply (compiler) { \n    compiler.hooks.emit.tapAsync('CopyrightWebpackPlugin',\n    \t(compilation, cb) => { // compilation:存放的是这次打包相关的内容\n          compilation.assets['copyright.txt'] = {\n            source: function () {\n              return 'copyright by dell lee';\n            },\n            size: function () {\n              return 21;\n            }\n          };\n      \t cb();\n    });\n  }\n}\nmodule.exports = CopyrightWebpackPlugin;\n")])])]),e("p",[t._v("详情可参考：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://git.lug.ustc.edu.cn/EvalGitHub/wepack-loader-plugin/blob/master/plugins/cpoyright-webpack-plugin.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://git.lug.ustc.edu.cn/EvalGitHub/wepack-loader-plugin/blob/master/plugins/cpoyright-webpack-plugin.js"),e("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=p.exports}}]);