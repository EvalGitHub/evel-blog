(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{514:function(n,t,e){"use strict";e.r(t);var a=e(28),s=Object(a.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"按顺序加载script的实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#按顺序加载script的实现"}},[n._v("#")]),n._v(" 按顺序加载script的实现")]),n._v(" "),e("p",[e("strong",[n._v("背景")])]),n._v(" "),e("p",[n._v("前端经常会加载很多很多js，如果多个模块之间有依赖执行的先后顺序，我们该怎么？em：c.js的执行依赖b.js，b.js的执行\n依赖a.js，那么我们必须实现这些模块的按序加载。")]),n._v(" "),e("p",[e("strong",[n._v("思路")])]),n._v(" "),e("p",[n._v("动态创建script，监听他的onload的事件，在每个onload事件中加载后一个js文件，")]),n._v(" "),e("p",[e("strong",[n._v("代码实现")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('// 按照顺序加载js\nexport function loadScript(url:string, callback?:() => void) {\n  let script:any = document.createElement("script");\n  script.type = "text/javascript";\n  script.defer=\'defer\';\n  script.src = url;\n  document.body.appendChild(script);\n  if (script.readyState) { // ie  \n    /*\n      “uninitialized” – 原始状态 \n      “loading” – 下载数据中..\n      “loaded” – 下载完成\n      “interactive” – 还未执行完毕.\n      “complete” – 脚本执行完毕.\n    */\n    return new Promise((resolve, reject) => {\n      script.onreadystatechange = function() {\n        if (script.readyState === "loaded" || script.readyState === "complete") {\n          script.onreadystatechange = null;\n          callback && callback();\n          resolve(0);\n        }\n      };\n    });\n  } else {\n    return new Promise((resolve, reject) => {\n      script.onload = function() { // ie并不支持 script.onload\n        callback && callback();\n        resolve(0);\n      };\n      script.onerror = function() {\n        // callback();\n        resolve(0);\n      };\n    })\n  }\n}\n')])])]),e("p",[e("strong",[n._v("使用")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('async componentDidMount() {\n  await loadScript("https://connect.qq.com/qc_jssdkeee.js", () => {});\n  await loadScript("https://nemo.codemao.cn/lib/tingyun-rum.js", () => {});\n  await loadScript("https://kn-cdn.codemao.cn/nemoy/jquery.dll.js?5958b534d8d5ab510f20", () => {});\n  await loadScript("https://kn-cdn.codemao.cn/nemoy/main.334e0cb7.js", () => {});\n}\n')])])])])}),[],!1,null,null,null);t.default=s.exports}}]);